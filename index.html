<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wedding Invitation - Zen & Yessica</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    /* ===== Global ===== */
    html, body{
      margin:0; padding:0;
      font-family:'Poppins', sans-serif;
      /* BG3 as page background */
      background: url("image/BG3.jpeg") no-repeat center center fixed;
      background-size: cover;
      color:#333; overflow-x:hidden;
    }
    h1, h2{ font-family:'Great Vibes', cursive; color:#bc6c89; }

    section{ padding:50px 20px; text-align:center; }
    .date{ font-size:1.3rem; margin:15px 0; }
    .venue{ margin:8px 0; font-style:italic; }
    .verse{ font-style:italic; max-width:600px; margin:auto; line-height:1.5; color:#555; }
    footer{ background:#333; color:#fff; padding:20px; margin-top:40px; }

    /* ===== Cover as its own page (NOT overlay) ===== */
    .cover{
      position: relative;            /* not fixed */
      width:100%;
      min-height:100vh;              /* full viewport */
      display:flex; flex-direction:column; justify-content:center; align-items:center;
      text-align:center;
      /* BG3 also on cover to guarantee same look */
      background: url("image/BG3.JPEG") no-repeat center center;
      background-size: cover;
    }
    .cover h1{
      font-size:3rem; color:#fff; margin-bottom:10px;
      text-shadow: 0 2px 10px rgba(0,0,0,.35);
    }
    .cover p{
      font-size:1.2rem; color:#fff; margin-bottom:30px;
      text-shadow: 0 1px 3px rgba(0,0,0,.30);
    }
    .cover button{
      padding:12px 30px; border:none; border-radius:30px;
      background:#fff; color:#bc6c89; font-size:1rem; font-weight:600; cursor:pointer;
      transition:.3s;
    }
    .cover button:hover{ background:#bc6c89; color:#fff; }

    /* ===== Hero ===== */
    .hero{
      min-height:100vh;
      background: transparent;       /* remove gradient/overlay */
      display:flex; flex-direction:column; justify-content:center; align-items:center;
      padding:20px; color:#fff;
      text-shadow: 0 2px 10px rgba(0,0,0,.35);
    }
    .hero h1{ font-size:4rem; margin-bottom:15px; }
    .hero .quote{ max-width:600px; font-size:1.2rem; margin:20px auto 40px; line-height:1.6; }
    #countdown{
      font-size:1.2rem; font-weight:bold; margin:20px 0 40px;
      display:flex; gap:20px; justify-content:center;
    }
    .time-box span{ display:block; font-size:2rem; }
    .btn{
      display:inline-block; padding:12px 30px; background:#bc6c89; border:none; color:#fff;
      border-radius:30px; text-decoration:none; font-size:1rem; transition:.3s;
    }
    .btn:hover{ background:#a44d6c; }

    /* ===== Music button ===== */
    #music-control{
      position:fixed; bottom:20px; right:20px;
      background:#bc6c89; color:#fff; border:none; border-radius:50%;
      width:50px; height:50px; font-size:1.2rem; cursor:pointer;
      box-shadow:0 4px 6px rgba(0,0,0,.2); display:none;
    }

    /* ===== RSVP & Notes ===== */
    form{
      max-width:500px; margin:0 auto; display:flex; flex-direction:column; gap:15px; text-align:left;
    }
    form input, form textarea, form select{
      padding:12px; border:1px solid #ddd; border-radius:8px; font-size:1rem; font-family:'Poppins',sans-serif;
    }
    form textarea{ min-height:100px; resize:vertical; }
    form button{ background:#bc6c89; color:#fff; padding:12px; border:none; border-radius:8px; font-size:1rem; cursor:pointer; transition:.3s; }
    form button:hover{ background:#a44d6c; }
    #responseMsg{ text-align:center; margin-top:15px; font-weight:600; }
    .attendance-wrapper{ margin-top:15px; text-align:center; }
    .attendance-label{ font-size:.9rem; color:#666; margin-bottom:8px; }
    #attendanceInput{ padding:12px; border:1px solid #ddd; border-radius:8px; font-size:1rem; width:80%; text-align:center; cursor:pointer; }
    .error-msg{ color:#d46a6a; font-size:.9rem; display:none; margin-top:5px; font-style:italic; }
    #notesContainer{ margin-top:30px; max-width:600px; margin-left:auto; margin-right:auto; text-align:left; }
    .note{ padding:12px; border-bottom:1px solid #ddd; }
    .note strong{ color:#bc6c89; }
    .pagination{ margin-top:15px; display:flex; justify-content:center; gap:10px; }
    .pagination button{ padding:8px 15px; border:none; border-radius:6px; background:#bc6c89; color:#fff; cursor:pointer; }
    .pagination button:disabled{ background:#ccc; cursor:not-allowed; }
  </style>
</head>
<body>

  <!-- üé∂ Music -->
  <audio id="bg-music" loop>
    <source src="music/Music-1.mp3" type="audio/mpeg">
  </audio>
  <button id="music-control">‚è∏Ô∏è</button>

  <!-- COVER PAGE (separate section, not overlay) -->
  <section class="cover" id="coverPage">
    <h1>Zen & Yessica</h1>
    <p>Dear <span id="guestName">Guest</span></p>
    <button id="openBtn">Open Invitation</button>
  </section>

  <!-- Save the Date -->
  <section class="hero">
    <h1>SAVE THE DATE</h1>
    <p class="quote">
      ‚ÄúMarriage is an act of worship, and every act of worship leads to His love as its ultimate goal. 
      It is only fitting that every effort to attain His love is pursued with joy.‚Äù
    </p>
    <div id="countdown">
      <div class="time-box"><span id="days">00</span>Days</div>
      <div class="time-box"><span id="hours">00</span>Hours</div>
      <div class="time-box"><span id="minutes">00</span>Minutes</div>
      <div class="time-box"><span id="seconds">00</span>Seconds</div>
    </div>
    <a class="btn" 
       href="https://calendar.google.com/calendar/render?action=TEMPLATE&text=Zen+%26+Yessica+Wedding&dates=20260117T030000Z/20260117T090000Z&details=Join+us+for+our+wedding+day!&location=Gereja+Santo+Fransiskus+Asisi,+Cibinong" 
       target="_blank">
      SAVE THE DATE
    </a>
  </section>

  <!-- Details -->
  <section>
    <h2>Wedding Day</h2>
    <p class="date">Saturday, 17 January 2026</p>
    <p class="venue">Holy Matrimony: Gereja Santo Fransiskus Asisi, Cibinong</p>
    <p class="venue">Reception: Bagas Raya Cibinong</p>
  </section>

  <!-- Verse -->
  <section>
    <h2>Bible Verse</h2>
    <p class="verse">
      ‚ÄúSo they are no longer two, but one flesh.  
      What therefore God has joined together, let no man separate.‚Äù  
      <br>‚Äì Matthew 19:6
    </p>
  </section>

  <!-- RSVP -->
  <section>
    <h2>RSVP & Notes</h2>
    <form id="rsvpForm">
      <input type="hidden" name="token" value="ZENYESSICA2026">
      <input type="hidden" id="referer" name="referer">

      <!-- Name -->
      <input name="Name" id="nameInput" type="text" placeholder="We‚Äôd like to know you üíå" required>
      <small id="nameError" class="error-msg">Oops, please tell us your name üå∑</small>

      <!-- Notes -->
      <textarea name="Notes" placeholder="Write your wishes and prayers for us"></textarea>

      <!-- Attendance -->
      <div class="attendance-wrapper">
        <p class="attendance-label">Attendance confirmation</p>
        <select name="Attendance" id="attendanceInput" required>
          <option value="">-- Select attendance --</option>
          <option value="Yes">üíñ Yes, I‚Äôll be there</option>
          <option value="No">üå∏ Sorry, can‚Äôt attend</option>
        </select>
        <small id="attendanceError" class="error-msg">Please let us know if you can attend üíê</small>
      </div>

      <button type="submit">SEND</button>
    </form>
    <p id="responseMsg"></p>

    <h2>Guest Notes üíå</h2>
    <div id="notesContainer">Loading...</div>
    <div class="pagination">
      <button id="prevBtn">Prev</button>
      <button id="nextBtn">Next</button>
    </div>
  </section>

  <footer>
    <p>With love, Zen & Yessica üíï</p>
  </footer>

  <!-- SCRIPT -->
  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbwRSHvhi28_Fes26DuLR8Ywf0zqY2U7ePzQCdb_4vyUH_Nq0_culqdSfb1U7tajj8zT/exec";
    document.getElementById("referer").value = window.location.hostname;

    // Elements
    const openBtn = document.getElementById("openBtn");
    const music = document.getElementById("bg-music");
    const controlBtn = document.getElementById("music-control");

    // Guest param
    const urlParams = new URLSearchParams(window.location.search);
    const guest = urlParams.get("to");
    if (guest) document.getElementById("guestName").textContent = guest;

    // Open Invitation -> show music button + scroll to hero (no overlay hide)
    openBtn.addEventListener("click", () => {
      controlBtn.style.display = "block";
      music.play().catch(()=>{});
      document.querySelector(".hero").scrollIntoView({ behavior: "smooth" });
    });

    // Music toggle
    controlBtn.addEventListener("click", () => {
      if (music.paused) { music.play(); controlBtn.textContent = "‚è∏Ô∏è"; }
      else { music.pause(); controlBtn.textContent = "‚ñ∂Ô∏è"; }
    });

    // Pause on tab hidden / close
    document.addEventListener("visibilitychange", () => {
      if (document.hidden) { music.pause(); controlBtn.textContent = "‚ñ∂Ô∏è"; }
    });
    window.addEventListener("beforeunload", () => music.pause());

    // Countdown
    function updateCountdown() {
      const weddingDate = new Date("Jan 17, 2026 09:00:00").getTime();
      const now = Date.now();
      const diff = weddingDate - now;
      if (diff <= 0) {
        document.getElementById("countdown").innerHTML = "üéâ Today is the wedding day!";
        return;
      }
      const d = Math.floor(diff / (1000*60*60*24));
      const h = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
      const m = Math.floor((diff % (1000*60*60)) / (1000*60));
      const s = Math.floor((diff % (1000*60)) / 1000);
      days.textContent = d; hours.textContent = h; minutes.textContent = m; seconds.textContent = s;
    }
    const days = document.getElementById("days"),
          hours = document.getElementById("hours"),
          minutes = document.getElementById("minutes"),
          seconds = document.getElementById("seconds");
    setInterval(updateCountdown, 1000); updateCountdown();

    // RSVP submit (unchanged)
    const form = document.getElementById("rsvpForm");
    const nameInput = document.getElementById("nameInput");
    const nameError = document.getElementById("nameError");
    const attendanceInput = document.getElementById("attendanceInput");
    const attendanceError = document.getElementById("attendanceError");
    const msg = document.getElementById("responseMsg");

    form.addEventListener("submit", e => {
      let valid = true;
      if (!nameInput.value.trim()) { nameError.style.display = "block"; valid = false; } else { nameError.style.display = "none"; }
      if (!attendanceInput.value)  { attendanceError.style.display = "block"; valid = false; } else { attendanceError.style.display = "none"; }
      if (!valid) { e.preventDefault(); msg.textContent = "‚ö†Ô∏è Please check the form again, some fields are missing üå∏"; msg.style.color = "#d46a6a"; return; }

      e.preventDefault();
      msg.textContent = "‚è≥ Sending..."; msg.style.color = "gray";
      fetch(scriptURL, { method: "POST", body: new FormData(form) })
        .then(res => res.json())
        .then(data => {
          if (data.status === "success") { msg.textContent = "‚úÖ RSVP berhasil dikirim! Thank you üíï"; msg.style.color = "green"; form.reset(); loadNotes(); }
          else { msg.textContent = "‚ùå Gagal mengirim RSVP."; msg.style.color = "red"; }
        })
        .catch(err => { msg.textContent = "‚ùå Error: " + err; msg.style.color = "red"; });
    });

    // Helper: waktu relatif
    function timeAgo(dateString) {
      const now = new Date(); const date = new Date(dateString);
      const diff = (now - date) / 1000;
      if (diff < 60) return "baru saja";
      const minutes = Math.floor(diff / 60);
      if (minutes < 60) return `${minutes} menit lalu`;
      const hours = Math.floor(minutes / 60);
      if (hours < 24) return `${hours} jam lalu`;
      const days = Math.floor(hours / 24);
      if (days < 7) return `${days} hari lalu`;
      const weeks = Math.floor(days / 7);
      if (weeks < 4) return `${weeks} minggu lalu`;
      const months = Math.floor(days / 30);
      return `${months} bulan lalu`;
    }

    // Notes + pagination (unchanged)
    let notes = []; let currentPage = 1; const notesPerPage = 5;
    async function loadNotes() {
      try {
        const res = await fetch(scriptURL);
        notes = await res.json();
        notes.sort((a,b)=> new Date(b.timestamp) - new Date(a.timestamp));
        renderNotes();
      } catch {
        document.getElementById("notesContainer").innerHTML = "<p>‚ùå Gagal load notes.</p>";
      }
    }
    function renderNotes() {
      const container = document.getElementById("notesContainer");
      container.innerHTML = "";
      if (!notes.length) { container.innerHTML = "<p>No notes yet.</p>"; return; }
      const start = (currentPage-1) * notesPerPage;
      const pageNotes = notes.slice(start, start + notesPerPage);
      pageNotes.forEach(n => {
        const icon = n.attendance === "Yes" ? "üíñ" : (n.attendance === "No" ? "üå∏" : "");
        container.innerHTML += `
          <div class="note">
            <strong>${n.name}</strong> ${icon}<br>
            <em>${n.notes}</em><br>
            <small>${timeAgo(n.timestamp)}</small>
          </div>`;
      });
      document.getElementById("prevBtn").disabled = currentPage === 1;
      document.getElementById("nextBtn").disabled = (currentPage * notesPerPage) >= notes.length;
    }
    document.getElementById("prevBtn").addEventListener("click", ()=>{ if (currentPage>1){ currentPage--; renderNotes(); }});
    document.getElementById("nextBtn").addEventListener("click", ()=>{ if ((currentPage*notesPerPage)<notes.length){ currentPage++; renderNotes(); }});
    loadNotes();
  </script>
</body>
</html>
