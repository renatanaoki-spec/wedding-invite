<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wedding Invitation - Zen & Yessica</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body, html {
      margin: 0;
      padding: 0;
      font-family: 'Poppins', sans-serif;
      background: url("BG2.jpeg") no-repeat center center fixed;
      background-size: cover;
      color: #f5f5f0; /* ivory */
      height: 100%;
      overflow-x: hidden;
      overflow-y: auto;
      animation: fadeIn 1.5s ease-in;
    }

    h1, h2 {
      font-family: 'Playfair Display', serif;
      color: #6b8f8e; /* misty aqua */
      letter-spacing: 1px;
      text-shadow: 0 0 8px rgba(219,230,228,0.6); /* pale mist glow */
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Cover */
    .cover {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      z-index: 9999;
      opacity: 1;
      visibility: visible;
      transition: opacity 1.2s ease, visibility 1.2s ease;
      backdrop-filter: blur(6px);
    }
    .cover.hidden { opacity: 0; visibility: hidden; }
    .cover h1 { font-size: 3rem; color: #fff; margin-bottom: 10px; }
    .cover p { font-size: 1.2rem; color: #fff; margin-bottom: 30px; }
    .cover button {
      padding: 12px 30px;
      border: none;
      border-radius: 30px;
      background: #6b8f8e;
      color: #fff;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .cover button:hover { background: #557877; }

    /* Smoke */
    #smoke {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 2;
      overflow: hidden;
    }
    .smoke {
      position: absolute;
      bottom: -200px;
      width: 300px;
      height: 300px;
      background: url('smoke.png') no-repeat center;
      background-size: cover;
      opacity: 0.25;
      animation: rise 18s linear infinite;
    }
    .smoke:nth-child(1) { left: 15%; animation-delay: 0s; }
    .smoke:nth-child(2) { left: 35%; animation-delay: 6s; width: 350px; height: 350px; }
    .smoke:nth-child(3) { left: 55%; animation-delay: 12s; width: 280px; height: 280px; }
    .smoke:nth-child(4) { left: 75%; animation-delay: 3s; width: 320px; height: 320px; }

    @keyframes rise {
      0% { transform: translateY(0) scale(1); opacity: 0.25; }
      50% { opacity: 0.4; }
      100% { transform: translateY(-800px) scale(1.5); opacity: 0; }
    }

    /* Sections */
    section {
      padding: 60px 20px;
      position: relative;
      z-index: 3;
      text-align: center;
    }

    /* Hero */
    .hero {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
      text-align: center;
      background: rgba(0,0,0,0.4);
      border-radius: 12px;
      animation: zoomIn 2s ease;
      z-index: 3;
      position: relative;
    }
    @keyframes zoomIn {
      from { transform: scale(0.95); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .hero h1 {
      font-size: 4rem;
      margin-bottom: 15px;
      animation: aquaGlow 3s ease-in-out infinite alternate;
    }
    @keyframes aquaGlow {
      from { text-shadow: 0 0 5px #a8c0b0, 0 0 10px #6b8f8e; }
      to { text-shadow: 0 0 15px #dbe6e4, 0 0 30px #6b8f8e; }
    }

    .quote {
      max-width: 600px;
      font-size: 1.2rem;
      margin: 20px auto 40px;
      line-height: 1.6;
      color: #eee;
    }

    #countdown {
      font-size: 1.2rem;
      font-weight: bold;
      margin: 20px 0 40px;
      display: flex;
      gap: 20px;
      justify-content: center;
    }
    .time-box span { display: block; font-size: 2rem; color: #6b8f8e; }

    .btn, form button {
      display: inline-block;
      padding: 12px 30px;
      background: #6b8f8e;
      border: none;
      color: #fff;
      border-radius: 30px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 12px rgba(107,143,142,0.3);
    }
    .btn:hover, form button:hover {
      background: #557877;
      box-shadow: 0 0 18px rgba(107,143,142,0.5);
      transform: scale(1.05);
    }

    /* Music button */
    #music-control {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(255,255,255,0.15);
      border: 2px solid #6b8f8e;
      color: #6b8f8e;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 1.4rem;
      cursor: pointer;
      box-shadow: 0 0 12px rgba(107,143,142,0.3);
      backdrop-filter: blur(6px);
      display: none;
      transition: all 0.3s ease;
      z-index: 10;
    }
    #music-control:hover {
      background: rgba(107,143,142,0.1);
      box-shadow: 0 0 18px rgba(107,143,142,0.6);
      transform: scale(1.08);
    }

    /* RSVP */
    form {
      max-width: 500px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 15px;
      text-align: left;
    }
    form input, form textarea, form select {
      padding: 12px;
      border: 1px solid #a8c0b0;
      border-radius: 8px;
      font-size: 1rem;
      background: rgba(255,255,255,0.85);
      color: #333;
    }
    form textarea { min-height: 100px; resize: vertical; }
    form input:focus, form textarea:focus, form select:focus {
      outline: none;
      border-color: #6b8f8e;
      box-shadow: 0 0 8px rgba(107,143,142,0.4);
    }

    .note {
      padding: 12px;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      opacity: 0;
      transform: translateY(15px);
      animation: fadeNote 0.8s forwards;
    }
    @keyframes fadeNote {
      to { opacity: 1; transform: translateY(0); }
    }
    .note strong { color: #6b8f8e; }

    .pagination button {
      padding: 8px 15px;
      border: none;
      border-radius: 6px;
      background: #6b8f8e;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .pagination button:hover {
      background: #557877;
      box-shadow: 0 0 10px rgba(107,143,142,0.5);
    }
    .pagination button:disabled {
      background: #ccc;
      cursor: not-allowed;
      box-shadow: none;
    }

    footer {
      background: rgba(0,0,0,0.7);
      color: #a8c0b0;
      padding: 20px;
      text-align: center;
      font-weight: 500;
    }
  </style>
</head>
<body>

  <!-- Smoke Effect -->
  <div id="smoke">
    <div class="smoke"></div>
    <div class="smoke"></div>
    <div class="smoke"></div>
    <div class="smoke"></div>
  </div>

  <!-- üé∂ Music -->
  <audio id="bg-music" loop>
    <source src="music/Music-1.mp3" type="audio/mpeg">
  </audio>
  <button id="music-control"><i class="fa-solid fa-music"></i></button>

  <!-- COVER PAGE -->
  <div class="cover" id="coverPage">
    <h1>Zen & Yessica</h1>
    <p>Dear <span id="guestName">Guest</span></p>
    <button id="openBtn">Open Invitation</button>
  </div>

  <!-- Hero -->
  <section class="hero">
    <h1>SAVE THE DATE</h1>
    <p class="quote">
      ‚ÄúMarriage is an act of worship, and every act of worship leads to His love as its ultimate goal. 
      It is only fitting that every effort to attain His love is pursued with joy.‚Äù
    </p>
    <div id="countdown">
      <div class="time-box"><span id="days">00</span>Days</div>
      <div class="time-box"><span id="hours">00</span>Hours</div>
      <div class="time-box"><span id="minutes">00</span>Minutes</div>
      <div class="time-box"><span id="seconds">00</span>Seconds</div>
    </div>
  </section>

  <!-- RSVP -->
  <section>
    <h2>RSVP & Notes</h2>
    <form id="rsvpForm">
      <input type="hidden" name="token" value="ZENYESSICA2026">
      <input type="hidden" id="referer" name="referer">
      <input name="Name" id="nameInput" type="text" placeholder="We‚Äôd like to know you üíå" required>
      <textarea name="Notes" placeholder="Write your wishes and prayers for us"></textarea>
      <select name="Attendance" id="attendanceInput" required>
        <option value="">-- Select attendance --</option>
        <option value="Yes">üíñ Yes, I‚Äôll be there</option>
        <option value="No">üå∏ Sorry, can‚Äôt attend</option>
      </select>
      <button type="submit">SEND</button>
    </form>
    <p id="responseMsg"></p>

    <h2>Guest Notes üíå</h2>
    <div id="notesContainer">Loading...</div>
    <div class="pagination">
      <button id="prevBtn">Prev</button>
      <button id="nextBtn">Next</button>
    </div>
  </section>

  <footer>
    <p>With love, Zen & Yessica üíï</p>
  </footer>

  <!-- SCRIPT -->
  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbwRSHvhi28_Fes26DuLR8Ywf0zqY2U7ePzQCdb_4vyUH_Nq0_culqdSfb1U7tajj8zT/exec";
    document.getElementById("referer").value = window.location.hostname;

    const cover = document.getElementById("coverPage");
    const openBtn = document.getElementById("openBtn");
    const music = document.getElementById("bg-music");
    const controlBtn = document.getElementById("music-control");

    const urlParams = new URLSearchParams(window.location.search);
    const guest = urlParams.get("to");
    if (guest) document.getElementById("guestName").textContent = guest;

    // Open invitation with fade + music
    openBtn.addEventListener("click", () => {
      cover.classList.add("hidden");
      controlBtn.style.display = "block";
      setTimeout(() => {
        music.play().catch(err => console.log("Autoplay blocked:", err));
      }, 1200);
    });

    // Music button toggle
    controlBtn.addEventListener("click", () => {
      const icon = controlBtn.querySelector("i");
      if (music.paused) {
        music.play();
        icon.classList.remove("fa-play", "fa-music");
        icon.classList.add("fa-pause");
      } else {
        music.pause();
        icon.classList.remove("fa-pause");
        icon.classList.add("fa-play");
      }
    });

    // Countdown
    function updateCountdown() {
      const weddingDate = new Date("Jan 17, 2026 09:00:00").getTime();
      const now = new Date().getTime();
      const diff = weddingDate - now;
      if (diff <= 0) {
        document.getElementById("countdown").innerHTML = "üéâ Today is the wedding day!";
        return;
      }
      const days = Math.floor(diff / (1000*60*60*24));
      const hours = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
      const minutes = Math.floor((diff % (1000*60*60)) / (1000*60));
      const seconds = Math.floor((diff % (1000*60)) / 1000);
      document.getElementById("days").textContent = days;
      document.getElementById("hours").textContent = hours;
      document.getElementById("minutes").textContent = minutes;
      document.getElementById("seconds").textContent = seconds;
    }
    setInterval(updateCountdown, 1000);
    updateCountdown();

    // RSVP form
    const form = document.getElementById("rsvpForm");
    const msg = document.getElementById("responseMsg");

    form.addEventListener("submit", e => {
      e.preventDefault();
      
      if (!form.Name.value.trim() || !form.Attendance.value) {
        msg.textContent = "‚ö†Ô∏è Please fill out name and attendance üå∏";
        msg.style.color = "#ffcccc";
        return;
      }

      msg.textContent = "‚è≥ Sending...";
      msg.style.color = "gray";

      fetch(scriptURL, { method: "POST", body: new FormData(form) })
        .then(res => res.json())
        .then(data => {
          if (data.status === "success") {
            msg.textContent = "‚úÖ RSVP berhasil dikirim! Thank you üíï";
            msg.style.color = "lightgreen";
            form.reset();
            loadNotes();
          } else if (data.status === "duplicate") {
            msg.textContent = "‚ö†Ô∏è You already submitted recently.";
            msg.style.color = "#ffcc66";
          } else if (data.status === "unauthorized" || data.status === "forbidden") {
            msg.textContent = "‚ùå Access denied. Please open from official link.";
            msg.style.color = "red";
          } else {
            msg.textContent = "‚ùå Gagal mengirim RSVP.";
            msg.style.color = "red";
          }
        })
        .catch(err => {
          msg.textContent = "‚ùå Error: " + err;
          msg.style.color = "red";
        });
    });

    // Helper: waktu relatif
    function timeAgo(dateString) {
      const now = new Date();
      const date = new Date(dateString);
      const diff = (now - date) / 1000;
      if (diff < 60) return "just now";
      const minutes = Math.floor(diff / 60);
      if (minutes < 60) return `${minutes} minute${minutes>1?"s":""} ago`;
      const hours = Math.floor(minutes / 60);
      if (hours < 24) return `${hours} hour${hours>1?"s":""} ago`;
      const days = Math.floor(hours / 24);
      if (days < 7) return `${days} day${days>1?"s":""} ago`;
      const weeks = Math.floor(days / 7);
      if (weeks < 4) return `${weeks} week${weeks>1?"s":""} ago`;
      const months = Math.floor(days / 30);
      return `${months} month${months>1?"s":""} ago`;
    }

    // Notes
    let notes = [];
    let currentPage = 1;
    const notesPerPage = 5;

    async function loadNotes() {
      try {
        const res = await fetch(scriptURL);
        notes = await res.json();
        notes.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        renderNotes();
      } catch (err) {
        document.getElementById("notesContainer").innerHTML = "<p>‚ùå Gagal load notes.</p>";
      }
    }

    function renderNotes() {
      const container = document.getElementById("notesContainer");
      container.innerHTML = "";
      if (!notes.length) {
        container.innerHTML = "<p>No notes yet.</p>";
        return;
      }
      const start = (currentPage - 1) * notesPerPage;
      const end = start + notesPerPage;
      const pageNotes = notes.slice(start, end);

      pageNotes.forEach((n, i) => {
        let attendanceIcon = "";
        if (n.attendance === "Yes") attendanceIcon = "üíñ";
        if (n.attendance === "No") attendanceIcon = "üå∏";

        const noteDiv = document.createElement("div");
        noteDiv.className = "note";
        noteDiv.style.animationDelay = `${i * 0.2}s`;
        noteDiv.innerHTML = `
          <strong>${n.name}</strong> ${attendanceIcon}<br>
          <em>${n.notes}</em><br>
          <small>${timeAgo(n.timestamp)}</small>
        `;
        container.appendChild(noteDiv);
      });

      document.getElementById("prevBtn").disabled = currentPage === 1;
      document.getElementById("nextBtn").disabled = end >= notes.length;
    }

    document.getElementById("prevBtn").addEventListener("click", () => {
      if (currentPage > 1) { currentPage--; renderNotes(); }
    });
    document.getElementById("nextBtn").addEventListener("click", () => {
      if ((currentPage * notesPerPage) < notes.length) { currentPage++; renderNotes(); }
    });

    loadNotes();
  </script>
</body>
</html>
