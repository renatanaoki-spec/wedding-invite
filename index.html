<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wedding Invitation - Zen & Yessica</title>

  <!-- Icons + Styles -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  
  <style>
    /* Fonts */
    @font-face{
      font-family:"White Angelica";
      src:url("data:font/truetype;base64,") format("truetype");
      font-display:swap;
    }
    @font-face{
      font-family:"Mrs Eaves";
      src:url("data:font/truetype;base64,") format("truetype");
      font-display:swap;
    }

    /* Theme */
    :root{
      --accent:#6b8e72;
      --accent-2:#557a60;
      --forest:#26352b;
      --ivory:#fffdf5;
    }

    /* Base */
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      font-family:"Mrs Eaves","Playfair Display",Georgia,serif;
      color:var(--forest);
      background: linear-gradient(135deg, #2d3748 0%, #4a5568 50%, #718096 100%);
      overflow:hidden;
    }

    /* Scrolling sections */
    #snap{
      height:100svh;
      overflow-y:auto;
      scroll-snap-type:y proximity;
      scroll-behavior:smooth;
    }
    
    section.s{
      position:relative;
      min-height:100svh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:clamp(24px,5vh,48px) 18px;
      scroll-snap-align:start;
      scroll-snap-stop:always;
      transform:translateZ(0);
    }

    /* HERO readability overlay */
    .hero::before{
      content:"";
      position:absolute;
      inset:0;
      z-index:0;
      background:
        radial-gradient(100% 70% at 50% 40%, rgba(18,24,21,.46) 0%, rgba(18,24,21,.20) 60%, rgba(18,24,21,.08) 100%),
        linear-gradient(to bottom, rgba(18,24,21,.38), rgba(18,24,21,.12) 55%, rgba(18,24,21,0));
      pointer-events:none;
    }
    .hero>.inner{position:relative;z-index:1}

    /* Cards */
    .inner{
      width:min(960px,92vw);
      border-radius:16px;
      padding:clamp(22px,3.5vw,32px);
    }
    .inner.transparent{
      background:transparent;
      box-shadow:none;
    }
    .card{
      background:rgba(255,255,255,.96);
      border:1px solid rgba(0,0,0,.06);
      box-shadow:0 18px 40px rgba(0,0,0,.18);
    }

    /* Typography */
    h1.title{
      color:#fff;
      font-size:clamp(38px,7vw,86px);
      margin:0 0 8px;
      text-shadow:0 4px 22px rgba(0,0,0,.55);
    }
    .names{
      font-family:"White Angelica",cursive;
      color:#fff;
      margin:8px 0 12px;
      font-size:clamp(32px,6vw,64px);
      -webkit-text-stroke:.5px rgba(0,0,0,.15);
      text-shadow:0 2px 10px rgba(0,0,0,.35),0 0 22px rgba(255,255,255,.3);
    }
    .quote{
      color:#f5f5f2;
      text-shadow:0 3px 14px rgba(0,0,0,.5);
      max-width:760px;
      margin:12px auto 22px;
      font-size:clamp(14px,2.5vw,18px);
    }
    h2{
      color:var(--accent-2);
      margin:0 0 .6rem;
    }
    .subtle{
      color:var(--accent-2);
      margin-top:1rem;
    }

    /* Countdown */
    #countdown{
      display:flex;
      gap:14px;
      justify-content:center;
      flex-wrap:wrap;
      margin:20px 0;
    }
    .chip{
      min-width:110px;
      text-align:center;
      padding:12px 16px;
      border-radius:14px;
      background:rgba(255,255,255,.18);
      border:1px solid rgba(255,255,255,.45);
      color:#fff;
      box-shadow:0 6px 18px rgba(0,0,0,.18);
    }
    .chip span{
      display:block;
      font-size:clamp(22px,4.6vw,32px);
      font-weight:bold;
    }
    .chip span.pop{
      animation:pop .5s cubic-bezier(.22,.61,.36,1);
    }
    @keyframes pop{
      0%{transform:scale(.9);opacity:.7}
      60%{transform:scale(1.08);opacity:1}
      100%{transform:scale(1)}
    }

    .cta{
      text-align:center;
      margin-top:16px;
    }
    .btn{
      display:inline-block;
      padding:12px 28px;
      border:none;
      border-radius:999px;
      background:var(--accent);
      color:#fff;
      font-weight:700;
      cursor:pointer;
      text-decoration:none;
      box-shadow:0 10px 24px rgba(86,122,96,.35);
      transition:.25s;
    }
    .btn:hover{
      background:var(--accent-2);
      transform:translateY(-2px);
    }

    /* FABs */
    .round-fab,.ai-fab{
      position:fixed;
      z-index:60;
      width:56px;
      height:56px;
      border:none;
      border-radius:50%;
      display:grid;
      place-items:center;
      cursor:pointer;
      color:#fff;
      background:linear-gradient(180deg,rgba(107,142,114,.95),rgba(86,122,96,.85));
      border:1px solid rgba(255,255,255,.55);
      box-shadow:0 12px 28px rgba(86,122,96,.35);
      transition:transform .18s ease,box-shadow .18s ease;
    }
    .round-fab:hover,.ai-fab:hover{
      transform:translateY(-2px) scale(1.04);
      box-shadow:0 16px 36px rgba(86,122,96,.45);
    }
    #music{bottom:20px;right:18px}
    #aiFab{bottom:90px;right:18px}
    #music i,#aiFab i{
      font-size:20px;
      line-height:1;
      filter:drop-shadow(0 1px 1px rgba(0,0,0,.25));
    }

    /* Form & Notes */
    form{
      max-width:560px;
      margin:0 auto;
      display:flex;
      flex-direction:column;
      gap:14px;
      text-align:left;
    }
    form input,form textarea,form select{
      padding:12px;
      border:1px solid #d9ded9;
      border-radius:10px;
      font-size:1rem;
      background:#fff;
    }
    form textarea{
      min-height:110px;
      resize:vertical;
    }
    .pagination{
      display:flex;
      gap:10px;
      justify-content:center;
      margin-top:12px;
    }
    .pagination button{
      padding:8px 14px;
      border:none;
      border-radius:8px;
      background:var(--accent);
      color:#fff;
      cursor:pointer;
    }
    .pagination button:disabled{
      background:#cfcfcf;
      cursor:not-allowed;
    }
    .note{
      padding:12px;
      border-bottom:1px solid rgba(0,0,0,.1);
      opacity:0;
      transform:translateY(8px);
    }
    .note.show{
      opacity:1;
      transform:none;
      transition:opacity .5s,transform .5s;
    }

    /* Aira Chat Panel */
    .ai-panel{
      position:fixed;
      right:18px;
      bottom:150px;
      z-index:60;
      width:min(92vw,380px);
      max-height:70vh;
      display:flex;
      flex-direction:column;
      background:rgba(255,255,255,.96);
      border-radius:16px;
      box-shadow:0 18px 40px rgba(0,0,0,.22);
      opacity:0;
      transform:translateY(12px);
      pointer-events:none;
      transition:.25s;
    }
    .ai-panel.open{
      opacity:1;
      transform:none;
      pointer-events:auto;
    }
    .ai-head{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:12px 14px;
      border-bottom:1px solid rgba(0,0,0,.08);
      color:var(--accent-2);
      font-weight:bold;
    }
    .ai-close{
      background:transparent;
      border:none;
      font-size:18px;
      cursor:pointer;
      color:var(--accent-2);
    }
    .ai-body{
      padding:12px;
      overflow-y:auto;
      flex:1;
      min-height:200px;
      max-height:300px;
    }
    .ai-msg{
      display:flex;
      margin:10px 0;
    }
    .ai-msg.user{
      justify-content:flex-end;
    }
    .ai-bubble{
      max-width:78%;
      padding:10px 12px;
      border-radius:14px;
      background:#f3f6f2;
      border:1px solid rgba(0,0,0,.06);
      color:var(--forest);
      word-wrap:break-word;
    }
    .ai-msg.user .ai-bubble{
      background:var(--accent);
      color:#fff;
      border-color:transparent;
    }
    .ai-form{
      display:flex;
      gap:8px;
      padding:12px;
      border-top:1px solid rgba(0,0,0,.08);
    }
    .ai-form input{
      flex:1;
      padding:10px 12px;
      border:1px solid #ddd;
      border-radius:12px;
      font-size:1rem;
      background:#fff;
    }
    .ai-form .btn{
      padding:10px 16px;
      font-size:14px;
    }

    /* Footer */
    footer{
      text-align:center;
      color:#4e6350;
      padding:26px 12px;
      font-weight:600;
      text-shadow:0 1px 1px rgba(255,255,255,.6);
      background:rgba(255,255,255,.1);
    }

    /* Response message styling */
    #responseMsg {
      text-align:center;
      margin-top:10px;
      padding:8px;
      border-radius:8px;
      font-weight:bold;
    }

    /* Responsive improvements */
    @media (max-width: 768px) {
      .chip {
        min-width:80px;
        padding:8px 12px;
      }
      .chip span {
        font-size:18px;
      }
      .ai-panel {
        width:calc(100vw - 20px);
        right:10px;
        bottom:100px;
      }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion:reduce){
      *{
        animation:none!important;
        transition:none!important;
        scroll-behavior:auto!important;
      }
    }

    /* Hidden initially */
    #dearLine {
      display: none;
    }
  </style>
</head>
<body>
  <!-- FABs -->
  <button id="aiFab" class="ai-fab" aria-label="Ask Aira">
    <i class="fa-regular fa-message"></i>
  </button>
  <button id="music" class="round-fab" title="Play/Pause" aria-label="Play music">
    <i class="fa-solid fa-play"></i>
  </button>

  <!-- Audio with fallback -->
  <audio id="bgm" preload="metadata" loop>
    <source src="https://www.soundjay.com/misc/sounds/bell-ringing-05.wav" type="audio/wav" />
    <p>Your browser does not support audio.</p>
  </audio>

  <main id="snap">
    <!-- HERO -->
    <section class="s hero" id="home">
      <div class="inner transparent">
        <h1 class="title">SAVE THE DATE</h1>
        <h2 class="names">Zen &amp; Yessica</h2>
        <p id="dearLine" class="quote"></p>

        <p class="quote">
          "Marriage is an act of worship, and every act of worship leads to His love as its ultimate goal.
          It is only fitting that every effort to attain His love is pursued with joy."
        </p>

        <div id="countdown" aria-label="Countdown to wedding">
          <div class="chip"><span id="d">00</span>Days</div>
          <div class="chip"><span id="h">00</span>Hours</div>
          <div class="chip"><span id="m">00</span>Minutes</div>
          <div class="chip"><span id="s">00</span>Seconds</div>
        </div>

        <p class="cta">
          <a class="btn" target="_blank" rel="noopener"
             href="https://calendar.google.com/calendar/render?action=TEMPLATE&text=Zen+%26+Yessica+Wedding&dates=20260117T030000Z/20260117T090000Z&details=Join+us+for+our+wedding+day!&location=Gereja+Santo+Fransiskus+Asisi,+Cibinong">
            Add to Google Calendar
          </a>
        </p>
      </div>
    </section>

    <!-- DETAILS -->
    <section class="s" id="details">
      <div class="inner card">
        <h2>Wedding Day</h2>
        <p><strong>Saturday, 17 January 2026</strong></p>
        <p><strong>Holy Matrimony:</strong> Gereja Santo Fransiskus Asisi, Cibinong</p>
        <p><strong>Reception:</strong> Bagas Raya Cibinong</p>
        <p><strong>Time:</strong> 09:00 AM (WIB)</p>
      </div>
    </section>

    <!-- VERSE -->
    <section class="s" id="verse">
      <div class="inner card">
        <h2>Bible Verse</h2>
        <p style="font-style:italic;font-size:1.1em;line-height:1.6;">
          "So they are no longer two, but one flesh. What therefore God has joined together, let no man separate."
          <br><strong>‚Äì Matthew 19:6</strong>
        </p>
      </div>
    </section>

    <!-- RSVP + NOTES -->
    <section class="s" id="rsvp">
      <div class="inner card">
        <h2>RSVP & Notes</h2>
        <form id="rsvpForm">
          <input type="hidden" name="token" value="ZENYESSICA2026" />
          <input type="hidden" id="referer" name="referer" />
          <input name="Name" type="text" placeholder="Your name üíå" required />
          <textarea name="Notes" placeholder="Write your wishes and prayers for us"></textarea>
          <select name="Attendance" required>
            <option value="">-- Will you attend? --</option>
            <option value="Yes">üíñ Yes, I'll be there</option>
            <option value="No">üå∏ Sorry, can't attend</option>
          </select>
          <button type="submit" class="btn">Send RSVP</button>
        </form>
        <div id="responseMsg"></div>

        <h3 class="subtle">Guest Notes üíå</h3>
        <div id="notesContainer">Loading notes...</div>
        <div class="pagination">
          <button id="prevBtn" type="button">‚Üê Previous</button>
          <button id="nextBtn" type="button">Next ‚Üí</button>
        </div>
      </div>
    </section>
  </main>

  <footer>With love, Zen &amp; Yessica üíï</footer>

  <!-- Aira Chat -->
  <div id="aiPanel" class="ai-panel" aria-live="polite" aria-hidden="true">
    <div class="ai-head">
      <strong>ü§ñ Aira - Wedding Assistant</strong>
      <button type="button" class="ai-close" id="aiClose" title="Close">‚úï</button>
    </div>
    <div id="aiBody" class="ai-body"></div>
    <form id="aiForm" class="ai-form">
      <input id="aiText" type="text" placeholder="Ask about the wedding..." autocomplete="off" />
      <button type="submit" class="btn">Send</button>
    </form>
  </div>

  <script>
    // ===== CONFIG =====
    const WEDDING_DATE = new Date("2026-01-17T09:00:00+07:00");
    
    // Mock Google Sheets URL (replace with real one)
    const scriptURL = "https://script.google.com/macros/s/AKfycbwRSHvhi28_Fes26DuLR8Ywf0zqY2U7ePzQCdb_4vyUH_Nq0_culqdSfb1U7tajj8zT/exec";

    // ===== MUSIC =====
    const audio = document.getElementById("bgm");
    const musicBtn = document.getElementById("music");
    const musicIcon = musicBtn.querySelector("i");

    function setPlayUI(playing) {
      if (playing) {
        musicIcon.classList.remove("fa-play");
        musicIcon.classList.add("fa-pause");
        musicBtn.setAttribute("aria-label", "Pause music");
      } else {
        musicIcon.classList.remove("fa-pause");
        musicIcon.classList.add("fa-play");
        musicBtn.setAttribute("aria-label", "Play music");
      }
    }

    musicBtn.addEventListener("click", () => {
      if (audio.paused) {
        audio.play()
          .then(() => setPlayUI(true))
          .catch((error) => {
            console.log("Audio play failed:", error);
            setPlayUI(false);
          });
      } else {
        audio.pause();
        setPlayUI(false);
      }
    });

    // Auto-pause when page is hidden
    document.addEventListener("visibilitychange", () => {
      if (document.hidden && !audio.paused) {
        audio.pause();
        setPlayUI(false);
      }
    });

    // Autoplay if coming from cover page
    function tryAutoplay() {
      audio.volume = 0.3; // Set comfortable volume
      audio.play()
        .then(() => setPlayUI(true))
        .catch(() => setPlayUI(false));
    }

    // Check for autoplay flag from cover page
    document.addEventListener("DOMContentLoaded", () => {
      try {
        if (sessionStorage.getItem("autoplay") === "1") {
          setTimeout(tryAutoplay, 500);
          sessionStorage.removeItem("autoplay");
        }
      } catch (e) {
        console.log("SessionStorage not available");
      }
    });

    // ===== COUNTDOWN =====
    const dEl = document.getElementById("d");
    const hEl = document.getElementById("h");
    const mEl = document.getElementById("m");
    const sEl = document.getElementById("s");
    
    let previousValues = {};

    function animateChange(element, value, key) {
      if (previousValues[key] !== value) {
        element.textContent = value.toString().padStart(2, '0');
        element.classList.remove("pop");
        void element.offsetWidth; // Force reflow
        element.classList.add("pop");
        previousValues[key] = value;
      }
    }

    function updateCountdown() {
      const now = Date.now();
      const weddingTime = WEDDING_DATE.getTime();
      const timeDiff = weddingTime - now;
      
      const countdownContainer = document.getElementById("countdown");
      
      if (timeDiff <= 0) {
        countdownContainer.innerHTML = "<h3 style='color:#fff;text-align:center;'>üéâ Today is the wedding day! üéâ</h3>";
        return;
      }
      
      const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
      
      animateChange(dEl, days, "days");
      animateChange(hEl, hours, "hours");
      animateChange(mEl, minutes, "minutes");
      animateChange(sEl, seconds, "seconds");
    }

    // Update countdown every second
    setInterval(updateCountdown, 1000);
    updateCountdown(); // Initial call

    // ===== Dear Guest Feature =====
    (function() {
      const urlParams = new URLSearchParams(window.location.search);
      const guestName = urlParams.get("to");
      const dearElement = document.getElementById("dearLine");
      
      if (guestName && dearElement) {
        dearElement.textContent = `Dear ${guestName},`;
        dearElement.style.display = "block";
      }
    })();

    // ===== RSVP & NOTES =====
    document.getElementById("referer").value = window.location.hostname;

    const form = document.getElementById("rsvpForm");
    const responseMsg = document.getElementById("responseMsg");
    
    // Mock notes data (replace with real API)
    let mockNotes = [
      {
        name: "Sarah Johnson",
        notes: "So excited for your special day! Can't wait to celebrate with you both! üíï",
        attendance: "Yes",
        timestamp: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString()
      },
      {
        name: "Michael Chen",
        notes: "Wishing you both a lifetime of happiness and love!",
        attendance: "Yes", 
        timestamp: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString()
      },
      {
        name: "Emma Davis",
        notes: "Unfortunately can't make it but sending all my love! ‚ù§Ô∏è",
        attendance: "No",
        timestamp: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString()
      }
    ];

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      
      const formData = new FormData(form);
      const name = formData.get("Name")?.trim();
      const attendance = formData.get("Attendance");
      const notes = formData.get("Notes")?.trim();
      
      if (!name || !attendance) {
        showMessage("‚ö†Ô∏è Please fill out your name and attendance status üå∏", "#c66");
        return;
      }
      
      showMessage("‚è≥ Sending your RSVP...", "#666");
      
      try {
        // Simulate API call
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // Add to mock data
        mockNotes.unshift({
          name: name,
          notes: notes || "Thank you for the invitation!",
          attendance: attendance,
          timestamp: new Date().toISOString()
        });
        
        showMessage("‚úÖ RSVP sent successfully! Thank you üíï", "green");
        form.reset();
        currentPage = 1;
        renderNotes();
        
      } catch (error) {
        console.error("RSVP submission error:", error);
        showMessage("‚ùå Failed to send RSVP. Please try again.", "crimson");
      }
    });

    function showMessage(text, color) {
      responseMsg.textContent = text;
      responseMsg.style.color = color;
      responseMsg.style.background = color === "green" ? "rgba(0,128,0,0.1)" : 
                                   color === "crimson" ? "rgba(220,20,60,0.1)" : "transparent";
    }

    // ===== NOTES PAGINATION =====
    let notes = [...mockNotes];
    let currentPage = 1;
    const notesPerPage = 3;

    function timeAgo(timestamp) {
      const now = new Date();
      const date = new Date(timestamp);
      const secondsAgo = Math.floor((now - date) / 1000);
      
      if (secondsAgo < 60) return "just now";
      
      const minutesAgo = Math.floor(secondsAgo / 60);
      if (minutesAgo < 60) return `${minutesAgo} minute${minutesAgo > 1 ? 's' : ''} ago`;
      
      const hoursAgo = Math.floor(minutesAgo / 60);
      if (hoursAgo < 24) return `${hoursAgo} hour${hoursAgo > 1 ? 's' : ''} ago`;
      
      const daysAgo = Math.floor(hoursAgo / 24);
      if (daysAgo < 7) return `${daysAgo} day${daysAgo > 1 ? 's' : ''} ago`;
      
      const weeksAgo = Math.floor(daysAgo / 7);
      if (weeksAgo < 4) return `${weeksAgo} week${weeksAgo > 1 ? 's' : ''} ago`;
      
      const monthsAgo = Math.floor(daysAgo / 30);
      return `${monthsAgo} month${monthsAgo > 1 ? 's' : ''} ago`;
    }

    function renderNotes() {
      const container = document.getElementById("notesContainer");
      container.innerHTML = "";
      
      if (!notes.length) {
        container.innerHTML = "<p style='text-align:center;color:#666;'>No notes yet. Be the first to leave one! üíå</p>";
        return;
      }
      
      const startIndex = (currentPage - 1) * notesPerPage;
      const endIndex = Math.min(startIndex + notesPerPage, notes.length);
      const pageNotes = notes.slice(startIndex, endIndex);
      
      pageNotes.forEach((note, index) => {
        const noteElement = document.createElement("div");
        noteElement.className = "note";
        noteElement.style.transitionDelay = (index * 100) + "ms";
        
        const attendanceIcon = note.attendance === "Yes" ? "üíñ" : "üå∏";
        const safeNotes = (note.notes || '').replace(/[<>&"']/g, (char) => {
          const entities = {'<': '&lt;', '>': '&gt;', '&': '&amp;', '"': '&quot;', "'": '&#39;'};
          return entities[char];
        });
        
        noteElement.innerHTML = `
          <div style="margin-bottom:8px;">
            <strong style="color:var(--accent);font-size:1.1em;">${note.name}</strong> 
            <span style="margin-left:8px;">${attendanceIcon}</span>
          </div>
          <div style="margin-bottom:8px;line-height:1.4;">${safeNotes}</div>
          <div style="font-size:0.9em;color:#666;font-style:italic;">${timeAgo(note.timestamp)}</div>
        `;
        
        container.appendChild(noteElement);
        
        // Animate in
        requestAnimationFrame(() => {
          noteElement.classList.add("show");
        });
      });
      
      // Update pagination buttons
      document.getElementById("prevBtn").disabled = currentPage === 1;
      document.getElementById("nextBtn").disabled = endIndex >= notes.length;
    }

    document.getElementById("prevBtn").addEventListener("click", () => {
      if (currentPage > 1) {
        currentPage--;
        renderNotes();
      }
    });

    document.getElementById("nextBtn").addEventListener("click", () => {
      if (currentPage * notesPerPage < notes.length) {
        currentPage++;
        renderNotes();
      }
    });

    // Initial render
    renderNotes();

    // ===== AIRA CHAT =====
    const KNOWLEDGE = {
      couple: "Zen & Yessica",
      date: new Date("2026-01-17T09:00:00+07:00"),
      datingAnniversary: new Date("2019-05-28T00:00:00+07:00"),
      favorites: { groomColor: "Blue", brideColor: "Yellow" },
      dreams: { groom: "Having a house in the mountains", couple: "Happy family" },
      maps: {
        matrimony: "https://www.google.com/maps/search/?api=1&query=Gereja+Santo+Fransiskus+Asisi,+Cibinong",
        reception: "https://www.google.com/maps/search/?api=1&query=Bagas+Raya+Cibinong"
      },
      calendarLink: "https://calendar.google.com/calendar/render?action=TEMPLATE&text=Zen+%26+Yessica+Wedding&dates=20260117T030000Z/20260117T090000Z&details=Join+us+for+our+wedding+day!&location=Gereja+Santo+Fransiskus+Asisi,+Cibinong"
    };

    const aiFab = document.getElementById("aiFab");
    const aiPanel = document.getElementById("aiPanel");
    const aiClose = document.getElementById("aiClose");
    const aiBody = document.getElementById("aiBody");
    const aiForm = document.getElementById("aiForm");
    const aiText = document.getElementById("aiText");
    const guestName = new URLSearchParams(window.location.search).get("to");

    let aiWelcomed = false;

    function openAI() {
      aiPanel.classList.add("open");
      aiText.focus();
      
      if (!aiWelcomed) {
        const welcomeMsg = guestName 
          ? `Hello ${guestName}! I'm <b>Aira</b> üëã. I can help you with information about ${KNOWLEDGE.couple}'s wedding: time, location, RSVP, directions, and more!`
          : `Hello! I'm <b>Aira</b> üëã. I can help you with information about ${KNOWLEDGE.couple}'s wedding: time, location, RSVP, directions, and more!`;
        
        botSay(welcomeMsg);
        aiWelcomed = true;
      }
    }

    function closeAI() {
      aiPanel.classList.remove("open");
    }

    aiFab.addEventListener("click", () => {
      aiPanel.classList.contains("open") ? closeAI() : openAI();
    });

    aiClose.addEventListener("click", closeAI);

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeAI();
    });

    function renderMessage(role, html) {
      const wrapper = document.createElement("div");
      wrapper.className = "ai-msg " + (role === "user" ? "user" : "ai");
      
      const bubble = document.createElement("div");
      bubble.className = "ai-bubble";
      bubble.innerHTML = html;
      
      wrapper.appendChild(bubble);
      aiBody.appendChild(wrapper);
      aiBody.scrollTop = aiBody.scrollHeight;
    }

    function userSay(text) {
      const safeText = text.replace(/[<>&"']/g, (char) => {
        const entities = {'<': '&lt;', '>': '&gt;', '&': '&amp;', '"': '&quot;', "'": '&#39;'};
        return entities[char];
      });
      renderMessage("user", safeText);
    }

    function botSay(html) {
      renderMessage("ai", html);
    }

    const formatDate = (date) => {
      return date.toLocaleString("en-US", {
        weekday: "long",
        year: "numeric", 
        month: "long",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        timeZone: "Asia/Jakarta"
      });
    };

    const formatDateShort = (date) => {
      return date.toLocaleDateString("en-US", {
        day: "2-digit",
        month: "long", 
        year: "numeric",
        timeZone: "Asia/Jakarta"
      });
    };

    const daysUntilWedding = (date) => {
      const now = Date.now();
      const weddingTime = date.getTime();
      const timeDiff = weddingTime - now;
      
      if (timeDiff <= 0) return "It's the wedding day!";
      
      const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      
      return `${days} days and ${hours} hours to go`;
    };

    function getAIResponse(text) {
      const query = text.toLowerCase().trim();
      
      // Greetings
      if (/\b(hi|hello|hey|halo|hai)\b/.test(query)) {
        return guestName 
          ? `Hello ${guestName}! How can Aira help you with the wedding?`
          : `Hello! How can Aira help you with the wedding?`;
      }
      
      // Couple information
      if (/\b(who|couple|bride|groom|pengantin)\b/.test(query)) {
        return `This wedding is for <b>${KNOWLEDGE.couple}</b> ü•Ç`;
      }
      
      // Date and time
      if (/\b(when|date|time|kapan|tanggal|jam|countdown)\b/.test(query)) {
        return `The wedding ceremony starts on <b>${formatDate(KNOWLEDGE.date)}</b> (WIB). <b>${daysUntilWedding(KNOWLEDGE.date)}</b>!`;
      }
      
      // Anniversary
      if (/\b(anniversary|dating|relationship|jadian|anniv)\b/.test(query)) {
        return `They've been together since <b>${formatDateShort(KNOWLEDGE.datingAnniversary)}</b> üíû`;
      }
      
      // Favorite colors
      if (/\b(color|favourite|favorite|warna)\b/.test(query)) {
        const isGroom = /(zen|groom|him|his)/.test(query);
        const isBride = /(yessica|bride|her|hers)/.test(query);
        
        if (isGroom) return `Zen's favorite color: <b>${KNOWLEDGE.favorites.groomColor}</b> üíô`;
        if (isBride) return `Yessica's favorite color: <b>${KNOWLEDGE.favorites.brideColor}</b> üíõ`;
        
        return `Favorite colors: Zen loves <b>${KNOWLEDGE.favorites.groomColor}</b> üíô and Yessica loves <b>${KNOWLEDGE.favorites.brideColor}</b> üíõ`;
      }
      
      // Dreams and goals
      if (/\b(dream|goal|future|impian|cita)\b/.test(query)) {
        return `Zen's dream: <b>${KNOWLEDGE.dreams.groom}</b> üèîÔ∏è<br>Their shared dream: <b>${KNOWLEDGE.dreams.couple}</b> ü´∂`;
      }
      
      // Location
      if (/\b(where|location|place|address|maps|lokasi|alamat|arah)\b/.test(query)) {
        return `Wedding locations:<br>‚Ä¢ Ceremony: <a href="${KNOWLEDGE.maps.matrimony}" target="_blank">Gereja Santo Fransiskus Asisi, Cibinong</a><br>‚Ä¢ Reception: <a href="${KNOWLEDGE.maps.reception}" target="_blank">Bagas Raya Cibinong</a>`;
      }
      
      // RSVP
      if (/\b(rsvp|attend|confirmation|hadir|konfirmasi)\b/.test(query)) {
        setTimeout(() => {
          document.querySelector('#rsvp')?.scrollIntoView({behavior: 'smooth'});
        }, 300);
        return `You can RSVP in the <b>RSVP & Notes</b> section. I've scrolled there for you! üòâ`;
      }
      
      // Calendar
      if (/\b(calendar|save|reminder|kalender)\b/.test(query)) {
        return `Click <a href="${KNOWLEDGE.calendarLink}" target="_blank">Add to Google Calendar</a> to save the date!`;
      }
      
      // Music
      if (/\b(music|song|sound|musik|lagu)\b/.test(query)) {
        return `The music control button is at the bottom right (‚ñ∂Ô∏è/‚è∏Ô∏è icon).`;
      }
      
      // Dress code
      if (/\b(dress|attire|wear|outfit|baju|pakaian)\b/.test(query)) {
        return `Dress code: <b>Semi-formal</b> in soft/pastel colors would be perfect! üëóüëî`;
      }
      
      // Default response
      return `I can help you with: "When is the wedding?", "Where is it?", "How to RSVP?", "Favorite colors?", "Dreams and goals?", "Dress code?"`;
    }

    aiForm.addEventListener("submit", (e) => {
      e.preventDefault();
      
      const userInput = aiText.value.trim();
      if (!userInput) return;
      
      userSay(userInput);
      botSay(getAIResponse(userInput));
      aiText.value = "";
    });

    // Initialize page
    document.addEventListener("DOMContentLoaded", () => {
      console.log("Wedding invitation loaded successfully!");
    });
  </script>
</body>
</html>
