<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wedding Invitation - Zen & Yessica</title>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@300;400;600&family=Playfair+Display:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">
    
    <style>
        /* Custom fonts to match the theme */
        @font-face {
            font-family: "White Angelica";
            src: url("font/WhiteAngelica.ttf") format("truetype");
            font-display: swap;
        }
        
        @font-face {
            font-family: "Mrs Eaves";
            src: url("font/MrsEaves.ttf") format("truetype");
            font-display: swap;
        }

        :root {
            --accent: #6b8e72;
            --accent-2: #557a60;
            --forest: #26352b;
            --ivory: #fffdf5;
            --warm-gold: #d4a574;
            --sunset-orange: #c8956d;
            --deep-burgundy: #6b4a3e;
            --soft-cream: #f5f0e8;
            --mountain-mist: rgba(139, 108, 91, 0.3);
            --text-glow: rgba(212, 165, 116, 0.6);
        }

        * {
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            margin: 0;
            font-family: "Mrs Eaves", "Playfair Display", Georgia, serif;
        }

        body {
            color: var(--forest);
            background: url("image/BG1.png") center/cover no-repeat fixed;
            overflow: hidden;
        }

        /* Scrolling sections */
        #snap {
            height: 100vh;
            overflow-y: auto;
            scroll-snap-type: y proximity;
            scroll-behavior: smooth;
        }

        section.s {
            position: relative;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: clamp(24px, 5vh, 48px) 18px;
            scroll-snap-align: start;
            scroll-snap-stop: always;
            transform: translateZ(0);
        }

        /* Hero overlay for readability */
        .hero::before {
            content: "";
            position: absolute;
            inset: 0;
            z-index: 0;
            background:
                radial-gradient(ellipse 120% 80% at 50% 30%, 
                    rgba(107, 74, 62, 0.45) 0%, 
                    rgba(139, 108, 91, 0.25) 40%, 
                    rgba(212, 165, 116, 0.15) 70%, 
                    rgba(107, 74, 62, 0.35) 100%),
                linear-gradient(to bottom, 
                    rgba(107, 74, 62, 0.3) 0%, 
                    rgba(200, 149, 109, 0.15) 30%, 
                    rgba(212, 165, 116, 0.1) 60%, 
                    rgba(107, 74, 62, 0.4) 100%);
            pointer-events: none;
        }

        .hero > .inner {
            position: relative;
            z-index: 1;
        }

        /* Cards */
        .inner {
            width: min(960px, 92vw);
            border-radius: 16px;
            padding: clamp(22px, 3.5vw, 32px);
        }

        .inner.transparent {
            background: transparent;
            box-shadow: none;
        }

        .card {
            background: linear-gradient(135deg, 
                rgba(245, 240, 232, 0.96) 0%, 
                rgba(255, 253, 245, 0.94) 100%);
            border: 1px solid rgba(212, 165, 116, 0.2);
            box-shadow: 0 18px 40px rgba(107, 74, 62, 0.18);
            backdrop-filter: blur(10px);
        }

        /* Typography */
        h1.title {
            color: var(--soft-cream);
            font-size: clamp(38px, 7vw, 86px);
            margin: 0 0 8px;
            text-shadow: 
                0 12px 40px rgba(107, 74, 62, 0.8),
                0 4px 16px rgba(212, 165, 116, 0.6),
                0 0 30px rgba(245, 240, 232, 0.4);
        }

        .names {
            font-family: "White Angelica", 'Great Vibes', cursive;
            color: var(--soft-cream);
            margin: 8px 0 12px;
            font-size: clamp(2.5rem, 8vw, 5rem);
            -webkit-text-stroke: 0.5px rgba(107, 74, 62, 0.15);
            text-shadow: 
                0 2px 10px rgba(107, 74, 62, 0.35),
                0 0 22px rgba(245, 240, 232, 0.3);
        }

        .quote {
            color: var(--soft-cream);
            text-shadow: 0 3px 14px rgba(107, 74, 62, 0.5);
            max-width: 760px;
            margin: 12px auto 22px;
            font-size: clamp(16px, 3vw, 18px);
            line-height: 1.6;
        }

        h2 {
            color: var(--accent-2);
            margin: 0 0 0.6rem;
            font-size: clamp(24px, 4vw, 32px);
        }

        h3 {
            color: var(--accent);
            margin: 0 0 0.5rem;
            font-size: clamp(18px, 3vw, 22px);
        }

        .subtle {
            color: var(--warm-gold);
            margin-top: 1rem;
            text-shadow: 0 2px 8px var(--text-glow);
        }

        /* Countdown */
        #countdown {
            display: flex;
            gap: 14px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 2rem 0;
        }

        .chip {
            min-width: 110px;
            text-align: center;
            padding: 12px 16px;
            border-radius: 14px;
            background: rgba(245, 240, 232, 0.25);
            border: 1px solid rgba(212, 165, 116, 0.4);
            color: var(--soft-cream);
            box-shadow: 0 6px 18px rgba(107, 74, 62, 0.18);
            backdrop-filter: blur(8px);
        }

        .chip span {
            display: block;
            font-size: clamp(22px, 4.6vw, 32px);
            font-weight: 600;
            color: var(--warm-gold);
        }

        .chip span.pop {
            animation: pop 0.5s cubic-bezier(0.22, 0.61, 0.36, 1);
        }

        @keyframes pop {
            0% { transform: scale(0.9); opacity: 0.7; }
            60% { transform: scale(1.08); opacity: 1; }
            100% { transform: scale(1); }
        }

        .cta {
            text-align: center;
            margin-top: 16px;
        }

        .btn {
            display: inline-block;
            padding: 12px 28px;
            border: none;
            border-radius: 999px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--sunset-orange) 100%);
            color: var(--ivory);
            font-weight: 700;
            cursor: pointer;
            text-decoration: none;
            box-shadow: 0 10px 24px rgba(200, 149, 109, 0.35);
            transition: all 0.25s ease;
            font-family: 'Playfair Display', serif;
        }

        .btn:hover {
            background: linear-gradient(135deg, var(--accent-2) 0%, var(--deep-burgundy) 100%);
            transform: translateY(-2px);
            box-shadow: 0 12px 28px rgba(200, 149, 109, 0.45);
        }

        /* FABs */
        .round-fab, .ai-fab {
            position: fixed;
            z-index: 60;
            width: 56px;
            height: 56px;
            border: none;
            border-radius: 50%;
            display: grid;
            place-items: center;
            cursor: pointer;
            color: var(--ivory);
            background: linear-gradient(180deg, var(--accent) 0.95, var(--accent-2) 0.85);
            border: 1px solid rgba(212, 165, 116, 0.55);
            box-shadow: 0 12px 28px rgba(200, 149, 109, 0.35);
            transition: transform 0.18s ease, box-shadow 0.18s ease;
        }

        .round-fab:hover, .ai-fab:hover {
            transform: translateY(-2px) scale(1.04);
            box-shadow: 0 16px 36px rgba(200, 149, 109, 0.45);
        }

        #music {
            bottom: 20px;
            right: 18px;
        }

        #aiFab {
            bottom: 90px;
            right: 18px;
        }

        #music i, #aiFab i {
            font-size: 20px;
            line-height: 1;
            filter: drop-shadow(0 1px 1px rgba(107, 74, 62, 0.25));
        }

        /* Form & Notes */
        form {
            max-width: 560px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 14px;
            text-align: left;
        }

        form input, form textarea, form select {
            padding: 12px;
            border: 1px solid rgba(212, 165, 116, 0.3);
            border-radius: 10px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.9);
            font-family: "Mrs Eaves", serif;
        }

        form textarea {
            min-height: 110px;
            resize: vertical;
        }

        .pagination {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 12px;
        }

        .pagination button {
            padding: 8px 14px;
            border: none;
            border-radius: 8px;
            background: var(--accent);
            color: var(--ivory);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .pagination button:hover {
            background: var(--accent-2);
        }

        .pagination button:disabled {
            background: #cfcfcf;
            cursor: not-allowed;
        }

        .note {
            padding: 12px;
            border-bottom: 1px solid rgba(212, 165, 116, 0.2);
            opacity: 0;
            transform: translateY(8px);
            transition: opacity 0.5s, transform 0.5s;
        }

        .note.show {
            opacity: 1;
            transform: none;
        }

        .note strong {
            color: var(--accent);
        }

        /* AI Panel */
        .ai-panel {
            position: fixed;
            right: 18px;
            bottom: 150px;
            z-index: 60;
            width: min(92vw, 380px);
            max-height: 70vh;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, 
                rgba(245, 240, 232, 0.96) 0%, 
                rgba(255, 253, 245, 0.94) 100%);
            border-radius: 16px;
            box-shadow: 0 18px 40px rgba(107, 74, 62, 0.22);
            border: 1px solid rgba(212, 165, 116, 0.3);
            opacity: 0;
            transform: translateY(12px);
            pointer-events: none;
            transition: all 0.25s ease;
            backdrop-filter: blur(10px);
        }

        .ai-panel.open {
            opacity: 1;
            transform: none;
            pointer-events: auto;
        }

        .ai-head {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 14px;
            border-bottom: 1px solid rgba(212, 165, 116, 0.2);
            color: var(--accent-2);
            font-weight: 600;
        }

        .ai-close {
            background: transparent;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: var(--accent);
            padding: 4px;
            border-radius: 4px;
            transition: background 0.2s ease;
        }

        .ai-close:hover {
            background: rgba(212, 165, 116, 0.1);
        }

        .ai-body {
            padding: 12px;
            overflow-y: auto;
            flex: 1;
            max-height: 300px;
        }

        .ai-msg {
            display: flex;
            margin: 10px 0;
        }

        .ai-msg.user {
            justify-content: flex-end;
        }

        .ai-bubble {
            max-width: 78%;
            padding: 10px 12px;
            border-radius: 14px;
            background: rgba(245, 240, 232, 0.8);
            border: 1px solid rgba(212, 165, 116, 0.2);
            color: var(--forest);
            line-height: 1.4;
        }

        .ai-msg.user .ai-bubble {
            background: var(--accent);
            color: var(--ivory);
            border-color: transparent;
        }

        .ai-form {
            display: flex;
            gap: 8px;
            padding: 12px;
            border-top: 1px solid rgba(212, 165, 116, 0.2);
        }

        .ai-form input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid rgba(212, 165, 116, 0.3);
            border-radius: 12px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.9);
        }

        .ai-form button {
            padding: 10px 12px;
            border: none;
            border-radius: 12px;
            background: var(--accent);
            color: var(--ivory);
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .ai-form button:hover {
            background: var(--accent-2);
        }

        /* Grid layouts */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .info-card {
            text-align: center;
            padding: 1rem;
            background: rgba(212, 165, 116, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(212, 165, 116, 0.2);
        }

        .info-card h4 {
            color: var(--accent-2);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .info-card p {
            font-size: 0.9rem;
            margin: 0.3rem 0;
        }

        /* Special sections */
        .verse-section {
            text-align: center;
            padding: 2rem 1rem;
        }

        .verse-text {
            font-size: 1.2rem;
            font-style: italic;
            line-height: 1.6;
            color: var(--forest);
            margin-bottom: 1rem;
        }

        .verse-reference {
            font-weight: 600;
            color: var(--accent-2);
        }

        .highlight-box {
            margin: 1.5rem 0;
            padding: 1rem;
            background: rgba(212, 165, 116, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(212, 165, 116, 0.2);
            text-align: center;
        }

        .highlight-box p {
            margin: 0;
            font-style: italic;
            color: var(--accent-2);
        }

        /* Footer */
        footer {
            text-align: center;
            color: var(--deep-burgundy);
            padding: 26px 12px;
            font-weight: 600;
            text-shadow: 0 1px 1px rgba(245, 240, 232, 0.6);
            background: rgba(245, 240, 232, 0.1);
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr;
            }

            .chip {
                min-width: 90px;
                padding: 10px 12px;
            }

            .ai-panel {
                width: 95vw;
                right: 2.5vw;
            }
        }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
                scroll-behavior: auto !important;
            }
        }
    </style>
</head>
<body>
    <!-- Background Music -->
    <audio id="bgm" loop>
        <source src="music/Music-1.mp3" type="audio/mpeg">
        <source src="music/Music-1.ogg" type="audio/ogg">
    </audio>

    <!-- Music Control Button -->
    <button id="music" class="round-fab" aria-label="Play music">
        <i class="fas fa-play"></i>
    </button>

    <!-- AI Assistant Button -->
    <button id="aiFab" class="ai-fab" aria-label="Open AI Assistant">
        <i class="fas fa-robot"></i>
    </button>

    <!-- AI Chat Panel -->
    <div id="aiPanel" class="ai-panel">
        <div class="ai-head">
            <strong>ü§ñ Aira - Wedding Assistant</strong>
            <button id="aiClose" class="ai-close">&times;</button>
        </div>
        <div id="aiBody" class="ai-body"></div>
        <form id="aiForm" class="ai-form">
            <input id="aiText" type="text" placeholder="Ask me anything about the wedding..." autocomplete="off">
            <button type="submit">
                <i class="fas fa-paper-plane"></i>
            </button>
        </form>
    </div>

    <!-- Main Content with Scroll Snap -->
    <div id="snap">
        <!-- Hero Section -->
        <section class="s hero">
            <div class="inner transparent">
                <p id="dearLine" class="subtle" style="display:none;">Dear Guest</p>
                <h1 class="title">SAVE THE DATE</h1>
                <div class="names">Zen & Yessica</div>
                <p class="quote">
                    "Marriage is an act of worship, and every act of worship leads to His love as its ultimate goal. 
                    It is only fitting that every effort to attain His love is pursued with joy."
                </p>
                
                <!-- Countdown Timer -->
                <div id="countdown">
                    <div class="chip">
                        <span id="d">00</span>
                        Days
                    </div>
                    <div class="chip">
                        <span id="h">00</span>
                        Hours
                    </div>
                    <div class="chip">
                        <span id="m">00</span>
                        Minutes
                    </div>
                    <div class="chip">
                        <span id="s">00</span>
                        Seconds
                    </div>
                </div>

                <div class="cta">
                    <a href="https://calendar.google.com/calendar/render?action=TEMPLATE&text=Zen+%26+Yessica+Wedding&dates=20260117T030000Z/20260117T090000Z&details=Join+us+for+our+wedding+day!&location=Gereja+Santo+Fransiskus+Asisi,+Cibinong" 
                       target="_blank" class="btn">
                        üíö Save the Date
                    </a>
                </div>
            </div>
        </section>

        <!-- Wedding Details -->
        <section class="s">
            <div class="inner card">
                <h2>üåÑ Wedding Day Details</h2>
                <div style="margin: 1.5rem 0;">
                    <h3>üìÖ Date & Time</h3>
                    <p><strong>Saturday, 17 January 2026</strong></p>
                    <p>09:00 AM (WIB)</p>
                </div>
                
                <div style="margin: 1.5rem 0;">
                    <h3>‚õ™ Holy Matrimony</h3>
                    <p><strong>Gereja Santo Fransiskus Asisi</strong></p>
                    <p>Cibinong, Bogor</p>
                    <a href="https://www.google.com/maps/search/?api=1&query=Gereja+Santo+Fransiskus+Asisi,+Cibinong" 
                       target="_blank" class="btn" style="margin-top: 8px; font-size: 0.9rem; padding: 8px 16px;">
                        üó∫Ô∏è View Location
                    </a>
                </div>

                <div style="margin: 1.5rem 0;">
                    <h3>üéâ Reception</h3>
                    <p><strong>Bagas Raya</strong></p>
                    <p>Cibinong, Bogor</p>
                    <a href="https://www.google.com/maps/search/?api=1&query=Bagas+Raya+Cibinong" 
                       target="_blank" class="btn" style="margin-top: 8px; font-size: 0.9rem; padding: 8px 16px;">
                        üó∫Ô∏è View Location
                    </a>
                </div>

                <div class="highlight-box">
                    <p>üíí Join us as we begin our journey together in God's love</p>
                </div>
            </div>
        </section>

        <!-- Bible Verse -->
        <section class="s">
            <div class="inner card">
                <h2>‚ú® God's Word for Us</h2>
                <div class="verse-section">
                    <p class="verse-text">
                        "So they are no longer two, but one flesh.<br>
                        What therefore God has joined together,<br>
                        let no man separate."
                    </p>
                    <p class="verse-reference">‚Äî Matthew 19:6</p>
                </div>
                
                <div class="highlight-box">
                    <p>üôè We believe that marriage is a sacred covenant blessed by God, 
                    where two hearts become one in His divine love and grace.</p>
                </div>
            </div>
        </section>

        <!-- Our Story -->
        <section class="s">
            <div class="inner card">
                <h2>üíï Our Love Story</h2>
                <div style="margin: 1.5rem 0;">
                    <h3>üåü How We Met</h3>
                    <p style="line-height: 1.6;">
                        Our paths crossed in God's perfect timing, and what started as friendship 
                        blossomed into a beautiful love story guided by His grace.
                    </p>
                </div>
                
                <div style="margin: 1.5rem 0;">
                    <h3>üìÖ Our Journey</h3>
                    <p><strong>Dating Anniversary:</strong> 28 May 2019</p>
                    <p style="line-height: 1.6; margin-top: 0.5rem;">
                        Together for <strong id="relationshipYears">7 years</strong> and counting! 
                        Through every season, our love has grown stronger with faith as our foundation.
                    </p>
                </div>

                <div style="margin: 1.5rem 0;">
                    <h3>üíôüíõ About Us</h3>
                    <div class="info-grid">
                        <div class="info-card">
                            <h4>Zen</h4>
                            <p>Favorite Color: <strong>Blue üíô</strong></p>
                            <p>Dream: House in the mountains üèîÔ∏è</p>
                        </div>
                        <div class="info-card">
                            <h4>Yessica</h4>
                            <p>Favorite Color: <strong>Yellow üíõ</strong></p>
                            <p>Our Dream: Happy family üë®‚Äçüë©‚Äçüëß‚Äçüë¶</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- RSVP Section -->
        <section class="s" id="rsvp">
            <div class="inner card">
                <h2>üíå RSVP & Wedding Notes</h2>
                <p style="text-align: center; margin-bottom: 1.5rem; color: var(--accent-2);">
                    Please let us know if you can celebrate with us! üíù
                </p>
                
                <form id="rsvpForm">
                    <input type="hidden" name="token" value="ZENYESSICA2026">
                    <input type="hidden" id="referer" name="referer">
                    
                    <input name="Name" type="text" placeholder="Your Name üíù" required>
                    
                    <textarea name="Notes" placeholder="Share your wishes, prayers, or a special message for us... ‚ú®" rows="4"></textarea>
                    
                    <select name="Attendance" required>
                        <option value="">-- Will you be joining us? --</option>
                        <option value="Yes">üíñ Yes, I'll be there!</option>
                        <option value="No">üå∏ Sorry, can't make it</option>
                    </select>
                    
                    <button type="submit" class="btn" style="width: 100%; margin-top: 0.5rem;">
                        üíå Send RSVP
                    </button>
                </form>
                
                <div id="responseMsg" style="text-align: center; margin-top: 1rem; font-weight: 600;"></div>
            </div>
        </section>

        <!-- Guest Notes -->
        <section class="s">
            <div class="inner card">
                <h2>üíï Messages from Our Loved Ones</h2>
                <div id="notesContainer">
                    <p style="text-align: center; color: var(--accent-2);">Loading messages...</p>
                </div>
                
                <div class="pagination">
                    <button id="prevBtn" disabled>‚Üê Previous</button>
                    <button id="nextBtn" disabled>Next ‚Üí</button>
                </div>
            </div>
        </section>

        <!-- Thank You -->
        <section class="s">
            <div class="inner card" style="text-align: center;">
                <h2>üôè Thank You</h2>
                <div style="margin: 2rem 0;">
                    <p style="font-size: 1.1rem; line-height: 1.6; color: var(--forest); margin-bottom: 1.5rem;">
                        We are so grateful for your love, support, and prayers as we begin this new chapter together.
                    </p>
                    <p style="font-size: 1.1rem; line-height: 1.6; color: var(--forest); margin-bottom: 1.5rem;">
                        Your presence in our lives means the world to us, and we can't wait to celebrate with you!
                    </p>
                    <div class="highlight-box">
                        <p style="font-size: 1rem;">
                            "Two hearts, one love, blessed by God above" üíí
                        </p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer>
        <p>Made with üíö for Zen & Yessica | January 17, 2026</p>
    </footer>

    <!-- JavaScript -->
    <script>
        // ===== Early Guard =====
        (function(){
            try{
                const qp = new URLSearchParams(location.search);
                if (qp.get('opened') !== '1') {
                    location.replace('index.html' + (location.search || ''));
                }
            }catch(e){}
        })();

        // ===== CONFIG =====
        const WEDDING_DATE = new Date("2026-01-17T09:00:00+07:00");
        const scriptURL = "https://script.google.com/macros/s/AKfycbwRSHvhi28_Fes26DuLR8Ywf0zqY2U7ePzQCdb_4vyUH_Nq0_culqdSfb1U7tajj8zT/exec";

        // ===== MUSIC =====
        const audio = document.getElementById("bgm");
        const musicBtn = document.getElementById("music");
        const musicIcon = musicBtn.querySelector("i");

        function setPlayUI(playing) {
            if (playing) {
                musicIcon.classList.remove("fa-play");
                musicIcon.classList.add("fa-pause");
                musicBtn.setAttribute("aria-label", "Pause music");
            } else {
                musicIcon.classList.remove("fa-pause");
                musicIcon.classList.add("fa-play");
                musicBtn.setAttribute("aria-label", "Play music");
            }
        }

        musicBtn.addEventListener("click", () => {
            if (audio.paused) {
                audio.play().then(() => { setPlayUI(true); sessionStorage.removeItem("autoplay"); })
                            .catch(() => setPlayUI(false));
            } else {
                audio.pause(); setPlayUI(false);
            }
        });

        // Autoplay if set by index.html
        function tryAutoplay(){
            audio.play().then(() => { setPlayUI(true); sessionStorage.removeItem("autoplay"); })
                        .catch(() => setPlayUI(false));
        }

        document.addEventListener("DOMContentLoaded", () => {
            if (sessionStorage.getItem("autoplay") === "1") {
                requestAnimationFrame(tryAutoplay);
                setTimeout(tryAutoplay, 150);
            }
        });

        window.addEventListener("pageshow", () => {
            if (sessionStorage.getItem("autoplay") === "1") tryAutoplay();
        });

        document.addEventListener("click", function once(){
            if (audio.paused) tryAutoplay();
            document.removeEventListener("click", once);
        }, { once:true });

        document.addEventListener("visibilitychange", () => {
            if (document.hidden) { audio.pause(); setPlayUI(false); }
        });

        // ===== COUNTDOWN =====
        const dEl = document.getElementById("d"),
              hEl = document.getElementById("h"),
              mEl = document.getElementById("m"),
              sEl = document.getElementById("s");
        let prev = {};

        const pop = (el, v, k) => {
            if (prev[k] !== v) {
                el.textContent = v;
                el.classList.remove("pop");
                void el.offsetWidth;
                el.classList.add("pop");
                prev[k] = v;
            }
        };

        function tick(){
            const t = WEDDING_DATE.getTime(), now = Date.now(), diff = t - now;
            const wrap = document.getElementById("countdown");
            if (diff <= 0) { 
                wrap.innerHTML = "üéâ Today is the wedding day!"; 
                return; 
            }
            pop(dEl, Math.floor(diff/86400000), "d");
            pop(hEl, Math.floor((diff%86400000)/3600000), "h");
            pop(mEl, Math.floor((diff%3600000)/60000), "m");
            pop(sEl, Math.floor((diff%60000)/1000), "s");
        }

        setInterval(tick, 1000);
        tick();

        // ===== Dear Guest =====
        (function(){
            const to = new URLSearchParams(location.search).get("to");
            if (to) {
                const el = document.getElementById("dearLine");
                el.textContent = `Dear ${to}`;
                el.style.display = "block";
            }
        })();

        // ===== RSVP & NOTES =====
        document.getElementById("referer").value = location.hostname;
        const form = document.getElementById("rsvpForm");
        const msg = document.getElementById("responseMsg");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            if (!form.Name.value.trim() || !form.Attendance.value) {
                msg.textContent = "‚ö†Ô∏è Please fill out name and attendance üå∏";
                msg.style.color = "#c66";
                return;
            }
            msg.textContent = "‚è≥ Sending...";
            msg.style.color = "#666";
            try {
                const r = await fetch(scriptURL, { method: "POST", body: new FormData(form) });
                const data = await r.json();
                if (data.status === "success") {
                    msg.textContent = "‚úÖ RSVP berhasil dikirim! Thank you üíï";
                    msg.style.color = "green";
                    form.reset();
                    currentPage = 1;
                    loadNotes();
                } else if (data.status === "duplicate") {
                    msg.textContent = "‚ö†Ô∏è You already submitted recently.";
                    msg.style.color = "#bb8a4e";
                } else if (data.status === "unauthorized" || data.status === "forbidden") {
                    msg.textContent = "‚ùå Access denied. Please open from official link.";
                    msg.style.color = "crimson";
                } else {
                    msg.textContent = "‚ùå Gagal mengirim RSVP.";
                    msg.style.color = "crimson";
                }
            } catch(err) {
                msg.textContent = "‚ùå Error: " + err;
                msg.style.color = "crimson";
            }
        });

        function timeAgo(ts){
            const now = new Date(), d = new Date(ts), s = (now - d) / 1000;
            if (s < 60) return "baru saja";
            const m = Math.floor(s / 60);
            if (m < 60) return `${m} menit lalu`;
            const h = Math.floor(m / 60);
            if (h < 24) return `${h} jam lalu`;
            const day = Math.floor(h / 24);
            if (day < 7) return `${day} hari lalu`;
            const w = Math.floor(day / 7);
            if (w < 4) return `${w} minggu lalu`;
            const mo = Math.floor(day / 30);
            return `${mo} bulan lalu`;
        }

        let notes = [], currentPage = 1, perPage = 5;

        async function loadNotes(){
            try {
                const res = await fetch(scriptURL);
                notes = await res.json();
                notes.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                renderNotes();
            } catch {
                document.getElementById("notesContainer").innerHTML = "<p>‚ùå Gagal load notes.</p>";
            }
        }

        function renderNotes(){
            const box = document.getElementById("notesContainer");
            box.innerHTML = "";
            if (!notes.length) {
                box.innerHTML = "<p>No notes yet.</p>";
                return;
            }
            const start = (currentPage - 1) * perPage;
            const page = notes.slice(start, start + perPage);
            page.forEach((n, i) => {
                const el = document.createElement("div");
                el.className = "note";
                el.style.transitionDelay = (i * 80) + "ms";
                const icon = n.attendance === "Yes" ? "üíñ" : (n.attendance === "No" ? "üå∏" : "");
                el.innerHTML = `<strong style="color:var(--accent)">${(n.name || "Guest").toString().replace(/</g, "&lt;")}</strong> ${icon}<br>
                                <em>${(n.notes || '').toString().replace(/</g, '&lt;')}</em><br>
                                <small>${timeAgo(n.timestamp)}</small>`;
                box.appendChild(el);
                requestAnimationFrame(() => el.classList.add("show"));
            });
            document.getElementById("prevBtn").disabled = start <= 0;
            document.getElementById("nextBtn").disabled = start + perPage >= notes.length;
        }

        document.getElementById("prevBtn").addEventListener("click", () => {
            if (currentPage > 1) {
                currentPage--;
                renderNotes();
            }
        });

        document.getElementById("nextBtn").addEventListener("click", () => {
            if (currentPage * perPage < notes.length) {
                currentPage++;
                renderNotes();
            }
        });

        loadNotes();

        // ===== AIRA CHAT =====
        const KNOWLEDGE = {
            couple: "Zen & Yessica",
            date: new Date("2026-01-17T09:00:00+07:00"),
            datingAnniversary: new Date("2019-05-28T00:00:00+07:00"),
            favorites: { groomColor: "Biru", brideColor: "Kuning" },
            dreams: { groom: "Memiliki rumah di pegunungan", couple: "Keluarga bahagia" },
            hobbies: { groom: [], bride: [], couple: [] },
            funFacts: [],
            maps: {
                matrimony: "https://www.google.com/maps/search/?api=1&query=Gereja+Santo+Fransiskus+Asisi,+Cibinong",
                reception: "https://www.google.com/maps/search/?api=1&query=Bagas+Raya+Cibinong"
            },
            calendarLink: "https://calendar.google.com/calendar/render?action=TEMPLATE&text=Zen+%26+Yessica+Wedding&dates=20260117T030000Z/20260117T090000Z&details=Join+us+for+our+wedding+day!&location=Gereja+Santo+Fransiskus+Asisi,+Cibinong"
        };

        const aiFab = document.getElementById("aiFab");
        const aiPanel = document.getElementById("aiPanel");
        const aiClose = document.getElementById("aiClose");
        const aiBody = document.getElementById("aiBody");
        const aiForm = document.getElementById("aiForm");
        const aiText = document.getElementById("aiText");
        const guest = new URLSearchParams(location.search).get("to");

        function openAI(){
            aiPanel.classList.add("open");
            aiText.focus();
            if (!sessionStorage.getItem("aira_welcomed")) {
                botSay(`Halo${guest ? " " + guest : ""}! Aku <b>Aira</b> üëã. Aku bisa bantu info acara ${KNOWLEDGE.couple}: waktu, lokasi, RSVP, arah ke tempat, dan lainnya.`);
                sessionStorage.setItem("aira_welcomed", "1");
            }
        }

        function closeAI(){
            aiPanel.classList.remove("open");
        }

        aiFab.addEventListener("click", () => {
            aiPanel.classList.contains("open") ? closeAI() : openAI();
        });

        aiClose.addEventListener("click", closeAI);

        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape") closeAI();
        });

        function renderMsg(role, html){
            const wrap = document.createElement("div");
            wrap.className = "ai-msg " + (role === "user" ? "user" : "ai");
            const b = document.createElement("div");
            b.className = "ai-bubble";
            b.innerHTML = html;
            wrap.appendChild(b);
            aiBody.appendChild(wrap);
            aiBody.scrollTop = aiBody.scrollHeight;
        }

        function userSay(t){
            renderMsg("user", t.replace(/[<>&"]/g, c => ({ "<": "&lt;", ">": "&gt;", "&": "&amp;", '"': "&quot;" }[c])));
        }

        function botSay(h){
            renderMsg("ai", h);
        }

        const fmtDate = d => d.toLocaleString("id-ID", {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
            hour: "2-digit",
            minute: "2-digit",
            timeZone: "Asia/Jakarta"
        });

        const formatDateShort = d => d.toLocaleDateString("id-ID", {
            day: "2-digit",
            month: "long",
            year: "numeric",
            timeZone: "Asia/Jakarta"
        });

        const daysTo = d => {
            const ms = d.getTime() - Date.now();
            if (ms <= 0) return "Hari ini!";
            const DD = Math.floor(ms / 86400000);
            const HH = Math.floor((ms % 86400000) / 3600000);
            return `${DD} hari ${HH} jam lagi`;
        };

        function reply(text){
            const q = text.toLowerCase();
            if (/\b(hai|halo|hello|hi)\b/.test(q)) {
                return `Halo${guest ? ' ' + guest : ''}! Ada yang bisa Aira bantu?`;
            }
            if (/siapa|pengantin|couple|bride|groom/.test(q)) {
                return `Acara ini untuk <b>${KNOWLEDGE.couple}</b> ü•Ç.`;
            }
            if (/kapan|tanggal|jam|time|when|countdown|berapa hari/.test(q)) {
                return `Pemberkatan dimulai <b>${fmtDate(KNOWLEDGE.date)}</b> (WIB). Tersisa <b>${daysTo(KNOWLEDGE.date)}</b>.`;
            }
            if (/jadian|anniv|anniversary|sejak.*(bersama|pacaran)|kapan.*jadian|tanggal.*jadian/.test(q)) {
                return `Tanggal jadian: <b>${formatDateShort(KNOWLEDGE.datingAnniversary)}</b> üíû`;
            }
            if (/warna( favorit| kesukaan)?|favorite color/.test(q)){
                const g = /(zen|groom|laki|cowok)/.test(q);
                const b = /(yessica|bride|perempuan|cewek)/.test(q);
                if (g) return `Warna kesukaan Zen: <b>${KNOWLEDGE.favorites.groomColor}</b> üíô`;
                if (b) return `Warna kesukaan Yessica: <b>${KNOWLEDGE.favorites.brideColor}</b> üíõ`;
                return `Warna favorit: Zen <b>${KNOWLEDGE.favorites.groomColor}</b> üíô & Yessica <b>${KNOWLEDGE.favorites.brideColor}</b> üíõ`;
            }
            if (/impian|cita-cita|mimpi|goals?/.test(q)) {
                return `Impian Zen: <b>${KNOWLEDGE.dreams.groom}</b> üèîÔ∏è<br>Impian bersama: <b>${KNOWLEDGE.dreams.couple}</b> ü´∂`;
            }
            if (/hobi|hobby|kegemaran|interest/.test(q)) {
                return `Hobi Zen/Yessica belum diisi.`;
            }
            if (/fun\s*fact|fakta unik|unik/.test(q)) {
                return `Fun fact belum ditambahkan üôÇ`;
            }
            if (/di mana|lokasi|alamat|where|maps|arah|route|direction/.test(q)) {
                return `Lokasi: <br>‚Ä¢ Pemberkatan: <a href="${KNOWLEDGE.maps.matrimony}" target="_blank">Gereja Santo Fransiskus Asisi, Cibinong</a><br>‚Ä¢ Resepsi: <a href="${KNOWLEDGE.maps.reception}" target="_blank">Bagas Raya Cibinong</a>`;
            }
            if (/rsvp|konfirmasi|hadir|attend|daftar/.test(q)){
                setTimeout(() => document.querySelector("#rsvp").scrollIntoView({behavior: "smooth"}), 300);
                return `Kamu bisa RSVP di bagian <b>RSVP & Notes</b>. Aku sudah menggulir ke sana üòâ.`;
            }
            if (/calendar|kalender|save the date|ingatkan/.test(q)) {
                return `Klik <a href="${KNOWLEDGE.calendarLink}" target="_blank">Add to Google Calendar</a> untuk menyimpan tanggalnya.`;
            }
            if (/musik|music|lagu|sound/.test(q)) {
                return `Tombol musik ada di kanan bawah (ikon ‚ñ∂Ô∏è/‚è∏Ô∏è).`;
            }
            if (/dress|tema|baju|warna/.test(q)) {
                return `Pilihan aman: <b>semi-formal</b> warna lembut/pastel.`;
            }
            return `Aku bisa bantu: "Kapan mulai?", "Lokasinya?", "Kapan jadian?", "Warna favorit?", "Impian?", "Cara RSVP?"`;
        }

        aiForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const t = aiText.value.trim();
            if (!t) return;
            userSay(t);
            botSay(reply(t));
            aiText.value = "";
        });

        // ===== Calculate Relationship Years =====
        function updateRelationshipYears() {
            const now = new Date();
            const start = new Date("2019-05-28");
            const years = Math.floor((now - start) / (1000 * 60 * 60 * 24 * 365.25));
            const element = document.getElementById("relationshipYears");
            if (element) {
                element.textContent = `${years} years`;
            }
        }

        // Initialize on page load
        document.addEventListener("DOMContentLoaded", () => {
            updateRelationshipYears();
        });
    </script>
</body>
</html>
